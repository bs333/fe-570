---
title: "FE570 - Homework #2"
subtitle: "I pledge my honor that I have abided by the Stevens Honor System."
author: "Sid Bhatia"
date: "2023-10-16"
output: pdf_document
---

## Problem 2.1

#### 1.

```{r}
# Load necessary packages.
library(xts)
library(highfrequency)

# Load in data set.
options(digits.secs=3)
absolute_path <- 'C:/Users/sbhatia2/My Drive/University/Academics/Semester V/FE570 - Market Microstructure and Trading Strategies/FE570 - Homework/FE570 - Homework #2/'
load(paste(absolute_path, "sampleTQdata.RData", sep = ""))

# Added to remove warnings about time zone mismatch.
Sys.setenv(TZ='GMT')

head(tqdata)
tail(tqdata)
```

##### i.

How many trades are in the dataset?

```{r}
# Retrieve number of trades by counting number of rows in dataset.
num_of_trades <- nrow(tqdata)
num_of_trades
```

As seen above, there are 8153 trades in the dataset.

##### ii.

Plot the trade prices $p_t$ and the best-bid $b_t$ and best-ask prices $a_t$ for the entire dataset.

```{r}
# Convert dataset to data frame for easier access.
TQ_df <- data.frame(Date = index(tqdata), tqdata)
head(TQ_df)

# Retrieve the 'asks' or 'offers' from data frame.
asks <- as.numeric(TQ_df$OFR)
head(asks)

# Retrieve 'bids' from data frame.
bids <- as.numeric(TQ_df$BID)
head(bids)

# Compute the 'mid' or middle price between bid and ask.
mids <- (bids + asks) * 0.5
head(mids)

# Establish minimum and maximum prices quoted.
p_min <- min(as.numeric(TQ_df$PRICE))
p_max <- max(as.numeric(TQ_df$PRICE))

p_min
p_max

# Plot trade prices and respective best-bid and best-ask prices using the mid price.
plot(as.numeric(TQ_df$PRICE), col = "green", type = "l", ylab = "Trade Price", 
    xlab = "Trade Number", main = "Price Fluctuation", ylim = c(p_min - 0.2, p_max + 0.2))
lines(mids, type = "l", col = "blue")
```

##### iii.

Do the same as in ii) but only for trades with counts 100:200 (100th trade to 200th trade).

```{r}
# Retrieve sliced data frame from 100 to 200 trades.
TQ_df_sliced <- data.frame(tqdata[100:200])
head(TQ_df_sliced)

# Retrieve the 'asks' or 'offers' from data frame.
asks_2 <- as.numeric(TQ_df_sliced$OFR)
head(asks_2)

# Retrieve 'bids' from data frame.
bids_2 <- as.numeric(TQ_df_sliced$BID)
head(bids_2)

# Compute the 'mid' or middle price between bid and ask.
mids_2 <- (bids_2 + asks_2) * 0.5
head(mids_2)

# Establish minimum and maximum prices quoted.
p_min_2 <- min(as.numeric(TQ_df_sliced$PRICE))
p_max_2 <- max(as.numeric(TQ_df_sliced$PRICE))

p_min_2
p_max_2

# Plot trade prices and respective best-bid and best-ask prices using the mid price.
plot(as.numeric(TQ_df_sliced$PRICE), col = "green", type = "l", ylab = "Trade Price", 
    xlab = "Trade Number", main = "Price Fluctuation", ylim = c(p_min_2 - 0.2, p_max_2 + 0.2))
lines(mids_2, type = "l", col = "blue")
```

#### 2.

Count how many trades take place within the spread $(p_t \in (b_t, a_t))$, and how many at the touch $(p_t = b_t$ or 
$p_t = a_t$). Give separately the three numbers, and test if their sum reproduces the total trade count from 1.i).

```{r}
bid <- sapply(TQ_df$BID, FUN = as.numeric)
ask <- sapply(TQ_df$OFR, FUN = as.numeric)
price <- sapply(TQ_df$PRICE, FUN = as.numeric)

# Check for number of prices within the range.
within <- length( which( (price > bid) & (price < ask) ) ) 

# Check for number of prices outside the range.
outside <- length( which ( (price < bid) | (price > ask) ) )

# Check for number of prices at the bid.
at_bid <- length( which( price == bid ) )

# Check for number of prices at the offer.
at_offer <- length( which( price == ask) )

within
outside
at_bid
at_offer

# Check if sum equals the total number of trades (8153).
sum(within, outside, at_bid, at_offer) == num_of_trades
```